#!/bin/sh
set -e

color_reset="\033[0;37m"
color_yellow="\033[1;33m"

max_count=20

if [[ "$1" ]]; then
    git checkout $@
else
    options=($(git status --porcelain -uno | sed s/^...//))
    count=${#options[@]}

    if [ "$count" -le "$max_count" ]; then
        PS3="
Please choose file to checkout: "

        echo " "
        echo "${color_yellow}Available files"
        echo "-----------------${color_reset}"
        echo " "

        select opt in "${options[@]}"
        do
            case $opt in
                *)
                    git checkout $opt
                    break
                    ;;
            esac
        done
    else
        echo " "
        echo "There are too many changed files ${color_yellow}[$count]${color_reset}, use old good manual way for checkouting.${color_reset}"
        echo " "
    fi;
fi;
